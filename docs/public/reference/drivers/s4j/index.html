<!doctype html><html lang=en><head><script integrity=sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1 src=https://docs.nosqlbench.io/js/theme.min.js></script><link href="https://docs.nosqlbench.io/abridge.css?h=17d1d14ae374495df55a" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://docs.nosqlbench.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link href=https://docs.nosqlbench.io/favicon.svg rel=icon type=image/svg+xml><link title="NoSQLBench Documentation Atom Feed" href=https://docs.nosqlbench.io/atom.xml rel=alternate type=application/atom+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>S4J | NoSQLBench Documentation</title><meta content="NoSQLBench Team" name=author><meta content="NoSQLBench Documentation" name=copyright><meta content="Auto-generated reference documentation for S4J" name=description><link href=https://docs.nosqlbench.io/reference/drivers/s4j/ rel=canonical><meta content=https://docs.nosqlbench.io/reference/drivers/s4j/ property=og:url><meta content=https://docs.nosqlbench.io/reference/drivers/s4j/ name=twitter:url><meta content="Auto-generated reference documentation for S4J" property=og:description><meta content="Auto-generated reference documentation for S4J" name=twitter:description><meta content="S4J | NoSQLBench Documentation" property=og:title><meta content="S4J | NoSQLBench Documentation" name=twitter:title><meta content=summary name=twitter:card><meta content="NoSQLBench Documentation" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2025-11-13 property=og:updated_time><script src="https://docs.nosqlbench.io/js/theme_button.js?h=12a31e87fcbe7a55e953" defer integrity=sha384-UBxLGgFVZtEgNzOU3WqKoFT1oILftGjShFO4WIs1dO/jK7SNyz7BMYCYt5PffTxe></script><script src="https://docs.nosqlbench.io/js/email.js?h=ee3dd742e11c5014fdef" defer integrity=sha384-y0LUfjslyVLYZvCOyhELpvKivlXAq27Vnbed54glXoe/pZSYS/Pfqghp/sQt1xcV></script><script src="https://docs.nosqlbench.io/js/codecopy.js?h=0a54f99e682443925d3a" defer integrity=sha384-qssVvPpQgISh4PFkSBGTgXEMzuFO8Hat5m1MsdkpannoByWSTpLfBe4iEVl3+RiP></script><script src="https://docs.nosqlbench.io/js/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer integrity=sha384-Q8viz7rndi8MSNDtItDgVWNSrCumjepopRMlz2nElkWPRXDQAcfiZGJbrCJVXdtw></script><script src="https://docs.nosqlbench.io/search_index.en.js?h=e2df0fd710d0c807a7aa" defer integrity=sha384-nyOftseEtxo2Pc23RFR1hxsCZHtUr0xOCP7JVJ8oGIs+cnDq6GZkzCq2hWZ2cJIh></script><script src="https://docs.nosqlbench.io/js/searchjava.js?h=36b818b07e8b2b318967" defer integrity=sha384-i6K7Uy98ZLnOwn6no8sDUTeBitDmiLHOKxkcJYbjgu6vQ3hdyMQPzmeuX04BRs8J></script><noscript><link href=https://docs.nosqlbench.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="NoSQLBench Documentation" href=https://docs.nosqlbench.io></a></big></div><div><div><ul><li><a href=https://docs.nosqlbench.io/tutorials/> Tutorials </a><li><a href=https://docs.nosqlbench.io/guides/> Guides </a><li><a href=https://docs.nosqlbench.io/reference/> Reference </a><li><a href=https://docs.nosqlbench.io/explanations/> Explanations </a><li><a href=https://docs.nosqlbench.io/development/> Development </a><li><a href=https://github.com/nosqlbench/nosqlbench target=_blank> GitHub </a><li><i class="js svgs adjust" id=mode type=reset></i></ul></div><div><div><form autocomplete=off class=js id=searchbox name=goSearch><div class=searchd><input id=searchinput placeholder=Search title=Search><button class="svgs svgm search" title=Search></button></div><div class=results><div id=suggestions></div></div></form></div></div></div></nav></header><main><article><h1><a href=https://docs.nosqlbench.io/reference/drivers/s4j/>S4J</a></h1><ul><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#1-overview>1. Overview</a><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#2-execute-nb-s4j-workload>2. Execute NB S4J Workload</a><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#3-nb-s4j-driver-configuration-parameter-file>3. NB S4J Driver Configuration Parameter File</a><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#4-nb-s4j-scenario-definition-file>4. NB S4J Scenario Definition File</a> <ul><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#41-document-level-parameters>4.1. Document Level Parameters</a><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#42-nb-s4j-workload-types>4.2. NB S4J Workload Types</a> <ul><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#421-publish-messages-to-a-jms-destination-queue-or-topic>4.2.1. Publish Messages to a JMS Destination, Queue or Topic</a><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#422-receiving-messages-from-a-jms-destination-queue-or-topic>4.2.2. Receiving Messages from a JMS Destination, Queue or Topic</a></ul><li><a href=https://docs.nosqlbench.io/reference/drivers/s4j/#43-s4j-named-scenario>4.3. S4J Named Scenario</a></ul></ul><hr><h1 id=1-overview>1. Overview</h1><p>This driver is similar to <a href=../../../../adapter-pulsar/src/main/resources/pulsar.md>NB Pulsar driver</a> that allows NB based workload generation and performance testing against a Pulsar cluster. It also follows a similar pattern to configure and connect to the Pulsar cluster for workload execution.<p>However, the major difference is instead of simulating native Pulsar client workloads, the NB S4J driver allows simulating JMS oriented workloads (that follows JMS spec 2.0 and 1.1) to be executed on the Pulsar cluster. Under the hood, this is achieved through DataStax’s [Starlight for JMS API] (https://github.com/datastax/pulsar-jms).<h1 id=2-execute-nb-s4j-workload>2. Execute NB S4J Workload</h1><p>The following is an example of executing a NB S4J workload (defined as <em>pulsar_s4j.yaml</em>)<pre class=language-shell data-lang=shell style=color:#c0c5ce;background-color:#2b303b><code class=language-shell data-lang=shell><span>$ &LTnb_cmd> run driver=s4j cycles=10000 threads=4 num_conn=2 num_session=2 session_mode="client_ack" strict_msg_error_handling="false" web_url=http://localhost:8080 service_url=pulsar://localhost:6650 config=/path/to/nb_s4j_config.properties yaml=/path/to/pulsar_s4j.yaml -vv --logs-dir=s4j_log
</span></code></pre><p>In the above NB CLI command, the S4J driver specific parameters are listed as below:<ul><li>num_conn: the number of JMS connections to be created<li>num_session: the number of JMS sessions per JMS connection <ul><li>Note that multiple JMS sessions can be created from one JMS connection, and they share the same connection characteristics.</ul><li>session_mode: the session mode used when creating a JMS session<li>web_url: the URL of the Pulsar web service<li>service_url: the URL of the Pulsar native protocol service<li>(optional) strict_msg_error_handling: whether to do strict error handling <ul><li>when true, Pulsar client error will not stop NB S4J execution<li>otherwise, any Pulsar client error will stop NB S4J execution</ul><li>(optional) max_s4jop_time: maximum time (in seconds) to execute the actual S4J operations (e.g. message sending or receiving). If NB execution time is beyond this limit, each NB cycle is just a no-op. Please NOTE: <ul><li>this is useful when controlled NB execution is needed with NB CLI scripting.<li>if this parameter is not specified or the value is 0, it means no time limitation. Every single NB cycle will trigger an actual S4J operation.</ul><li>(optional) track_msg_cnt: When set to true (with default as false), the S4J driver will keep track of the confirmed response count for message sending and receiving.</ul><p>Other NB engine parameters are straight forward:<ul><li>driver: must be <strong>s4j</strong><li>threads: depending on the workload type, the NB thread number determines how many producers or consumers will be created. All producers or consumers will share the available JMS connections and sessions<li>yamL: the NB S4J scenario definition yaml file<li>config: specify the file that contains the connection parameters used by the S4J API</ul><h1 id=3-nb-s4j-driver-configuration-parameter-file>3. NB S4J Driver Configuration Parameter File</h1><p>The S4J API has a list of configuration options that can be found here: https://docs.datastax.com/en/streaming/starlight-for-jms/latest/reference/pulsar-jms-reference.html.<p>The NB S4J driver supports these configuration options via a config property file, an example of which is listed below. The configuration parameters in this file are grouped into several groups. The comments below explain how the grouping works.<pre style=color:#c0c5ce;background-color:#2b303b><code><span>###########
</span><span># Overview: Starlight for JMS (S4J) API configuration items are listed at:
</span><span>#           https://docs.datastax.com/en/fast-pulsar-jms/docs/1.1/pulsar-jms-reference.html#_configuration_options
</span><span>enableTransaction=true
</span><span>
</span><span>####
</span><span># S4J API specific configurations (non Pulsar specific) - jms.***
</span><span>
</span><span>jms.enableClientSideEmulation=true
</span><span>jms.usePulsarAdmin=false
</span><span>#...
</span><span>
</span><span>#####
</span><span># Pulsar client related configurations - client.***
</span><span># - Valid settings: http://pulsar.apache.org/docs/en/client-libraries-java/#client
</span><span>#
</span><span># - These Pulsar client settings (without the "client." prefix) will be
</span><span>#   directly used as S4J configuration settings, on a 1-to-1 basis.
</span><span>#--------------------------------------
</span><span># only relevant when authentication is enabled
</span><span>client.authPlugin=org.apache.pulsar.client.impl.auth.AuthenticationToken
</span><span>client.authParams=file:///path/to/authentication/jwt/file
</span><span># only relevant when in-transit encryption is enabled
</span><span>client.tlsTrustCertsFilePath=/path/to/certificate/file
</span><span>#...
</span><span>
</span><span>#####
</span><span># Producer related configurations (global) - producer.***
</span><span># - Valid settings: http://pulsar.apache.org/docs/en/client-libraries-java/#configure-producer
</span><span>#
</span><span># - These Pulsar producer settings (without "producer." prefix) will be collectively (as a map)
</span><span>#   mapped to S4J connection setting of "producerConfig"
</span><span>#--------------------------------------
</span><span>producer.blockIfQueueFull=true
</span><span># disable producer batching
</span><span>#producer.batchingEnabled=false
</span><span>#...
</span><span>
</span><span>#####
</span><span># Consumer related configurations (global) - consumer.***
</span><span># - Valid settings: http://pulsar.apache.org/docs/en/client-libraries-java/#configure-consumer
</span><span>#
</span><span># - These Pulsar producer settings (without "consumer." portion) will be collectively (as a map)
</span><span>#   mapped to S4J connection setting of "consumerConfig"
</span><span>#--------------------------------------
</span><span>#...
</span></code></pre><h1 id=4-nb-s4j-scenario-definition-file>4. NB S4J Scenario Definition File</h1><p>Like any NB scenario yaml file, the NB S4J yaml file is composed of 3 major components:<ul><li>bindings: define NB bindings<li>params: define document level parameters<li>blocks: define various statement blocks. Each statement block represents one JMS workload type</ul><pre style=color:#c0c5ce;background-color:#2b303b><code><span>bindings:
</span><span> ... ...
</span><span>params:
</span><span> ... ...
</span><span>blocks:
</span><span> ... ...
</span></code></pre><h2 id=41-document-level-parameters>4.1. Document Level Parameters</h2><p>The parameters defined in this section will be applicable to all statement blocks. An example of some common parameters that can be set at the document level is listed below:<ul><li>temporary_dest: whether JMS workload is dealing with a temporary destination<li>dest_type: JMS destination type - queue or topic</ul><pre style=color:#c0c5ce;background-color:#2b303b><code><span>params:
</span><span> temporary_dest: "false"
</span><span> dest_type: "&LTjms_destination_type>"
</span><span> async_api: "true"
</span><span> txn_batch_num: &LTnumber_of_message_ops_in_one_transaction>
</span><span> blocking_msg_recv: &LTwhehter_to_block_when_receiving_messages>
</span><span> shared_topic: &LTif_shared_topic_or_not>  // only relevant when the destination type is a topic
</span><span> durable_topic: &LTif_durable_topic_or_not>  // only relevant when the destination type is a topic
</span></code></pre><p>Please <strong>NOTE</strong> that the above parameters won’t necessarily be specified at the document level. If they’re specified at the statement level, they will only impact the statement within which they’re specified.<h2 id=42-nb-s4j-workload-types>4.2. NB S4J Workload Types</h2><p>The NB S4J driver supports 2 types of JMS operations:<ul><li>One for message producing/sending/publishing <ul><li>this is identified by NB Op identifier <em><strong>MessageProduce</strong></em></ul><li>One for message consuming/receiving/subscribing <ul><li>this is identified by NB Op identifier <em><strong>MessageConsume</strong></em></ul></ul><h3 id=421-publish-messages-to-a-jms-destination-queue-or-topic>4.2.1. Publish Messages to a JMS Destination, Queue or Topic</h3><p><em><strong>NOTE</strong>: Please see <a href=https://docs.nosqlbench.io/reference/drivers/s4j/scenarios/pulsar_s4j_producer.yaml>pulsar_s4j_producer.yaml</a> as the complete example.</em><p>The NB S4J statement block for publishing messages to a JMS destination (either a Queue or a topic) has the following format.<ul><li>Optionally, you can specify the JMS headers (<strong>msg_header</strong>) and properties (<strong>msg_property</strong>) via valid JSON strings in key: value format.<li>The default message type (<strong>msg_type</strong>) is “byte”. But optionally, you can specify other message types such as “text”, “map”, etc.<li>The message payload (<strong>msg_body</strong>) is the only mandatory field.</ul><pre class=language-yaml data-lang=yaml style=color:#c0c5ce;background-color:#2b303b><code class=language-yaml data-lang=yaml><span style=color:#bf616a>blocks</span><span>:
</span><span>  </span><span style=color:#bf616a>msg-produce-block</span><span>:
</span><span>    </span><span style=color:#bf616a>ops</span><span>:
</span><span>      </span><span style=color:#bf616a>op1</span><span>:
</span><span>        </span><span style=color:#65737e>## The value represents the destination (queue or topic) name)
</span><span>        </span><span style=color:#bf616a>MessageProduce</span><span>: "</span><span style=color:#a3be8c>mys4jtest_t</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) JMS headers (in JSON format).
</span><span>        </span><span style=color:#bf616a>msg_header</span><span>: </span><span style=color:#b48ead>|
</span><span style=color:#a3be8c>          {
</span><span style=color:#a3be8c>            "&LTheader_key>": "&LTheader_value>"
</span><span style=color:#a3be8c>          }
</span><span style=color:#a3be8c>
</span><span>        </span><span style=color:#65737e>## (Optional) JMS properties, predefined or customized (in JSON format).
</span><span>        </span><span style=color:#bf616a>msg_property</span><span>: </span><span style=color:#b48ead>|
</span><span style=color:#a3be8c>          {
</span><span style=color:#a3be8c>            "&LTproperty1_key>": "&LTproperty_value1>",
</span><span style=color:#a3be8c>            "&LTproperty2_key>": "&LTproperty_value2>"
</span><span style=color:#a3be8c>          }
</span><span style=color:#a3be8c>
</span><span>        </span><span style=color:#65737e>## (Optional) JMS message types, default to be BYTES.
</span><span>        </span><span style=color:#bf616a>msg_type</span><span>: "</span><span style=color:#a3be8c>text</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Mandatory) JMS message body. Value depends on msg_type.
</span><span>        </span><span style=color:#bf616a>msg_body</span><span>: "</span><span style=color:#a3be8c>{mytext_val}</span><span>"
</span></code></pre><h3 id=422-receiving-messages-from-a-jms-destination-queue-or-topic>4.2.2. Receiving Messages from a JMS Destination, Queue or Topic</h3><p><em><strong>NOTE</strong>: Please see <a href=https://docs.nosqlbench.io/reference/drivers/s4j/scenarios/pulsar_s4j_consumer.yaml>pulsar_s4j_consumer.yaml</a> as the complete example.</em><p>The generic NB S4J statement block for receiving messages to a JMS destination (either a Queue or a topic) has the following format. All the statement specific parameters are listed as below.<ul><li><strong>msg_selector</strong>: Message selector string<li><strong>no_local</strong>: Only applicable to a Topic as the destination. This allows a subscriber to inhibit the delivery of messages published by its own connection.<li><strong>read_timeout</strong>: The timeout value for receiving a message from a destination <ul><li>This setting only works if <strong>no_wait</strong> is false<li>If the <strong>read_timeout</strong> value is 0, it behaves the same as <strong>no_wait</strong> is true</ul><li><strong>no_wait</strong>: Whether to receive the next message immediately if one is available<li><strong>msg_ack_ratio</strong>: the ratio of the received messages being acknowledged<li><strong>slow_ack_in_sec</strong>: whether to simulate a slow consumer (pause before acknowledging after receiving a message) <ul><li>value 0 means no simulation (consumer acknowledges right away)</ul><li>negative ack/ack timeout/deadletter topic related settings <ul><li>The settings here (as the scenario specific settings) will be merged with the<li>global settings in <em>s4j_config.properties</em> file</ul></ul><pre class=language-yaml data-lang=yaml style=color:#c0c5ce;background-color:#2b303b><code class=language-yaml data-lang=yaml><span style=color:#bf616a>blocks</span><span>:
</span><span>  </span><span style=color:#bf616a>msg-produce-block</span><span>:
</span><span>    </span><span style=color:#bf616a>ops</span><span>:
</span><span>      </span><span style=color:#bf616a>op1</span><span>:
</span><span>        </span><span style=color:#65737e>## The value represents the destination (queue or topic) name)
</span><span>        </span><span style=color:#bf616a>MessageProduce</span><span>: "</span><span style=color:#a3be8c>mys4jtest_t</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) client side message selector
</span><span>        </span><span style=color:#bf616a>msg_selector</span><span>: ""
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) No Local
</span><span>        </span><span style=color:#bf616a>no_local</span><span>: "</span><span style=color:#a3be8c>true</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) Read Timeout
</span><span>        </span><span style=color:#bf616a>read_timeout</span><span>: "</span><span style=color:#a3be8c>10</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) Receive message without wait
</span><span>        </span><span style=color:#bf616a>no_wait</span><span>: "</span><span style=color:#a3be8c>true</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) Message acknowledgement ratio
</span><span>        </span><span style=color:#bf616a>msg_ack_ratio</span><span>: "</span><span style=color:#a3be8c>0.5</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>## (Optional) Simulate slow consumer acknowledgement
</span><span>        </span><span style=color:#65737e># must be non-negative numbers. negative numbers will be treated as 0
</span><span>        </span><span style=color:#65737e># 0 - means no simulation
</span><span>        </span><span style=color:#65737e># positive value - the number of seconds to pause before acknowledgement
</span><span>        </span><span style=color:#bf616a>slow_ack_in_sec</span><span>: "</span><span style=color:#a3be8c>0</span><span>"
</span><span>
</span><span>        </span><span style=color:#65737e>#####
</span><span>        </span><span style=color:#65737e>## (Optional) Statement level settings for Consumer
</span><span>        </span><span style=color:#65737e>#
</span><span>        </span><span style=color:#65737e>## AckTimeout value (at least 1 second)
</span><span>        </span><span style=color:#bf616a>consumer.ackTimeoutMillis</span><span>: </span><span style=color:#d08770>1000
</span><span>
</span><span>        </span><span style=color:#65737e>## DLQ policy
</span><span>        </span><span style=color:#bf616a>consumer.deadLetterPolicy</span><span>: '</span><span style=color:#a3be8c>{ "maxRedeliverCount": "2" }</span><span>'
</span><span>
</span><span>        </span><span style=color:#65737e>## NegativeAck Redelivery policy
</span><span>        </span><span style=color:#bf616a>consumer.negativeAckRedeliveryBackoff</span><span>: </span><span style=color:#b48ead>|
</span><span style=color:#a3be8c>          {
</span><span style=color:#a3be8c>          }
</span><span style=color:#a3be8c>
</span><span>        </span><span style=color:#65737e>## AckTimeout Redelivery policy
</span><span>        </span><span style=color:#bf616a>consumer.ackTimeoutRedeliveryBackoff</span><span>: </span><span style=color:#b48ead>|
</span><span style=color:#a3be8c>          {
</span><span style=color:#a3be8c>            "minDelayMs":"10",
</span><span style=color:#a3be8c>            "maxDelayMs":"20",
</span><span style=color:#a3be8c>            "multiplier":"1.2"
</span><span style=color:#a3be8c>          }
</span></code></pre><h2 id=43-s4j-named-scenario>4.3. S4J Named Scenario</h2><p>For workload execution convenience, NB engine has the concept of <strong>named scenario</strong> (<a href=https://docs.nosqlbench.io/workloads-101/11-named-scenarios/ rel=noopener target=_blank>doc</a>).<p>For NB S4R adapter, the following yaml file is used to define the named scenarios: <a href=https://docs.nosqlbench.io/reference/drivers/s4j/scenarios/nbs4j_msg_proc_named.yaml>nbs4j_msg_proc_named.yaml</a><p>The CLI command to execute the S4J named scenarios (against an AS streaming tenant) is as simple as below. By default, the scenarios will be executed against localhost.<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># for message sender workload
</span><span style=color:#bf616a>$ </span><span>&LTnb_cmd> nbs4j_msg_proc_named msg_send service_url=pulsar+ssl://pulsar-gcp-uscentral1.streaming.datastax.com:6651 web_url=https://pulsar-gcp-uscentral1.api.streaming.datastax.com
</span><span>
</span><span>
</span><span style=color:#65737e># for message receiver workload
</span><span style=color:#bf616a>$ </span><span>&LTnb_cmd> nbs4j_msg_proc_named msg_recv service_url=pulsar+ssl://pulsar-gcp-uscentral1.streaming.datastax.com:6651 web_url=https://pulsar-gcp-uscentral1.api.streaming.datastax.com
</span><span>
</span></code></pre><nav><div></div><div><a href=https://docs.nosqlbench.io/reference/drivers/diag/> diag ›</a></div></nav></article></main><footer><div class=c><nav class=tpad><div></div></nav><p>© <span id=year>2025</span> NoSQLBench Documentation<p>Powered by <a href=https://www.getzola.org/ target=_blank>Zola</a> & <a href=https://github.com/jieiku/abridge/ target=_blank>Abridge</a></div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>