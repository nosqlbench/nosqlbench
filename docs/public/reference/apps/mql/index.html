<!doctype html><html lang=en><head><script integrity=sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1 src=https://docs.nosqlbench.io/js/theme.min.js></script><link href="https://docs.nosqlbench.io/abridge.css?h=17d1d14ae374495df55a" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://docs.nosqlbench.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link href=https://docs.nosqlbench.io/favicon.svg rel=icon type=image/svg+xml><link title="NoSQLBench Documentation Atom Feed" href=https://docs.nosqlbench.io/atom.xml rel=alternate type=application/atom+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>MetricsQL Query Engine | NoSQLBench Documentation</title><meta content="NoSQLBench Team" name=author><meta content="NoSQLBench Documentation" name=copyright><meta content="Auto-generated reference documentation for MetricsQL Query Engine" name=description><link href=https://docs.nosqlbench.io/reference/apps/mql/ rel=canonical><meta content=https://docs.nosqlbench.io/reference/apps/mql/ property=og:url><meta content=https://docs.nosqlbench.io/reference/apps/mql/ name=twitter:url><meta content="Auto-generated reference documentation for MetricsQL Query Engine" property=og:description><meta content="Auto-generated reference documentation for MetricsQL Query Engine" name=twitter:description><meta content="MetricsQL Query Engine | NoSQLBench Documentation" property=og:title><meta content="MetricsQL Query Engine | NoSQLBench Documentation" name=twitter:title><meta content=summary name=twitter:card><meta content="NoSQLBench Documentation" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2025-11-13 property=og:updated_time><script src="https://docs.nosqlbench.io/js/theme_button.js?h=12a31e87fcbe7a55e953" defer integrity=sha384-UBxLGgFVZtEgNzOU3WqKoFT1oILftGjShFO4WIs1dO/jK7SNyz7BMYCYt5PffTxe></script><script src="https://docs.nosqlbench.io/js/email.js?h=ee3dd742e11c5014fdef" defer integrity=sha384-y0LUfjslyVLYZvCOyhELpvKivlXAq27Vnbed54glXoe/pZSYS/Pfqghp/sQt1xcV></script><script src="https://docs.nosqlbench.io/js/codecopy.js?h=0a54f99e682443925d3a" defer integrity=sha384-qssVvPpQgISh4PFkSBGTgXEMzuFO8Hat5m1MsdkpannoByWSTpLfBe4iEVl3+RiP></script><script src="https://docs.nosqlbench.io/js/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer integrity=sha384-Q8viz7rndi8MSNDtItDgVWNSrCumjepopRMlz2nElkWPRXDQAcfiZGJbrCJVXdtw></script><script src="https://docs.nosqlbench.io/search_index.en.js?h=e2df0fd710d0c807a7aa" defer integrity=sha384-nyOftseEtxo2Pc23RFR1hxsCZHtUr0xOCP7JVJ8oGIs+cnDq6GZkzCq2hWZ2cJIh></script><script src="https://docs.nosqlbench.io/js/searchjava.js?h=36b818b07e8b2b318967" defer integrity=sha384-i6K7Uy98ZLnOwn6no8sDUTeBitDmiLHOKxkcJYbjgu6vQ3hdyMQPzmeuX04BRs8J></script><noscript><link href=https://docs.nosqlbench.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="NoSQLBench Documentation" href=https://docs.nosqlbench.io></a></big></div><div><div><ul><li><a href=https://docs.nosqlbench.io/tutorials/> Tutorials </a><li><a href=https://docs.nosqlbench.io/guides/> Guides </a><li><a href=https://docs.nosqlbench.io/reference/> Reference </a><li><a href=https://docs.nosqlbench.io/explanations/> Explanations </a><li><a href=https://docs.nosqlbench.io/development/> Development </a><li><a href=https://github.com/nosqlbench/nosqlbench target=_blank> GitHub </a><li><i class="js svgs adjust" id=mode type=reset></i></ul></div><div><div><form autocomplete=off class=js id=searchbox name=goSearch><div class=searchd><input id=searchinput placeholder=Search title=Search><button class="svgs svgm search" title=Search></button></div><div class=results><div id=suggestions></div></div></form></div></div></div></nav></header><main><article><h1><a href=https://docs.nosqlbench.io/reference/apps/mql/>MetricsQL Query Engine</a></h1><h1 id=metricsql-query-engine>MetricsQL Query Engine</h1><p>MetricsQL is a query engine for analyzing NoSQLBench SQLite metrics databases. It provides a MetricsQL/PromQL-inspired interface for querying time-series metrics data.<h2 id=quick-start>Quick Start</h2><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Show session information
</span><span style=color:#bf616a>nb5</span><span> mql session
</span><span>
</span><span style=color:#65737e># List available metrics with tree view
</span><span style=color:#bf616a>nb5</span><span> mql summary
</span><span>
</span><span style=color:#65737e># Explore metrics with their label sets
</span><span style=color:#bf616a>nb5</span><span> mql metrics
</span><span>
</span><span style=color:#65737e># Get current metric values
</span><span style=color:#bf616a>nb5</span><span> mql instant</span><span style=color:#bf616a> --metric</span><span> api_requests_total
</span><span>
</span><span style=color:#65737e># Query time-series data
</span><span style=color:#bf616a>nb5</span><span> mql range</span><span style=color:#bf616a> --metric</span><span> ops_total</span><span style=color:#bf616a> --window</span><span> 5m
</span><span>
</span><span style=color:#65737e># Calculate request rate
</span><span style=color:#bf616a>nb5</span><span> mql rate</span><span style=color:#bf616a> --metric</span><span> requests_total</span><span style=color:#bf616a> --window</span><span> 5m
</span></code></pre><h2 id=available-commands>Available Commands</h2><h3 id=discovery-commands>Discovery Commands</h3><ul><li><strong>session</strong> - Display session timeline and snapshot information<li><strong>summary</strong> - List all metrics with types and sample counts<li><strong>metrics</strong> - List all metrics with their label sets in tree view<li><strong>sql</strong> - Execute raw SQLite queries for advanced analysis</ul><h3 id=query-commands>Query Commands</h3><ul><li><strong>instant</strong> - Get the most recent value for a metric<li><strong>range</strong> - Retrieve time-series data over a time window<li><strong>topk</strong> - Find top N label sets by metric value</ul><h3 id=calculation-commands>Calculation Commands</h3><ul><li><strong>rate</strong> - Calculate per-second rate of change for counters<li><strong>increase</strong> - Calculate total increase in counter over time window<li><strong>quantile</strong> - Extract percentile values from timer/summary metrics<li><strong>agg</strong> - Perform aggregations (sum, avg, max, min, count) with grouping<li><strong>ratio</strong> - Calculate ratio between two metrics (e.g., error rate)</ul><h2 id=output-formats>Output Formats</h2><p>All commands support multiple output formats via <code>--format</code>:<ul><li><strong>table</strong> (default) - ASCII tables for console<li><strong>json</strong> - Pretty-printed JSON for programmatic use<li><strong>jsonl</strong> - JSON Lines for streaming<li><strong>csv</strong> - Comma-separated values for spreadsheets<li><strong>tsv</strong> - Tab-separated values for Unix tools<li><strong>markdown</strong> - GitHub-flavored markdown tables</ul><h2 id=tree-display-features>Tree Display Features</h2><p>The <code>summary</code> and <code>metrics</code> commands use intelligent tree display to organize metrics hierarchically:<h3 id=automatic-condensation-default>Automatic Condensation (Default)</h3><p>By default, metrics with common label patterns are condensed into a tree structure:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Shows condensed tree view
</span><span style=color:#bf616a>nb5</span><span> mql metrics
</span><span>
</span><span style=color:#65737e># Example output:
</span><span style=color:#bf616a>activity</span><span>=</span><span style=color:#a3be8c>read, </span><span style=color:#bf616a>env</span><span>=</span><span style=color:#a3be8c>prod
</span><span style=color:#bf616a>├──</span><span> host=server1
</span><span style=color:#bf616a>│</span><span>   ├── region=us-east
</span><span style=color:#bf616a>│</span><span>   └── region=us-west
</span><span style=color:#bf616a>└──</span><span> host=server2
</span><span>    </span><span style=color:#bf616a>└──</span><span> region=us-east
</span></code></pre><h3 id=tree-display-options>Tree Display Options</h3><ul><li><p><strong><code>--no-condense</code></strong> - Disable condensation, show each metric instance separately with full label sets</p> <pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>nb5</span><span> mql summary</span><span style=color:#bf616a> --no-condense
</span></code></pre><li><p><strong><code>--group-by=&LTmode></code></strong> - Control grouping strategy (metrics command only)</p> <ul><li><code>name</code> (default) - Group by metric name<li><code>labelset</code> - Group by label set structure</ul> <pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>nb5</span><span> mql metrics</span><span style=color:#bf616a> --group-by</span><span> labelset
</span></code></pre><li><p><strong><code>--keep-labels=&LTlabels></code></strong> - Preserve specific labels from elision (default: activity,session)</p> <pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Keep all labels visible
</span><span style=color:#bf616a>nb5</span><span> mql summary</span><span style=color:#bf616a> --keep-labels </span><span>'</span><span style=color:#a3be8c>*</span><span>'
</span><span>
</span><span style=color:#65737e># Keep specific labels
</span><span style=color:#bf616a>nb5</span><span> mql summary</span><span style=color:#bf616a> --keep-labels</span><span> activity,session,region
</span></code></pre></ul><h3 id=how-tree-condensation-works>How Tree Condensation Works</h3><p>The tree display uses a two-phase approach:<ol><li><strong>Canonical Layer (LabelSetTree)</strong>: Maintains strict label set containment relationships<li><strong>Display Layer (DisplayTree)</strong>: Applies three condensation algorithms: <ul><li><strong>Differential labels</strong>: Show only labels differing from parent<li><strong>Sibling condensation</strong>: Merge siblings differing by single label (comma-separated values)<li><strong>Identical consolidation</strong>: Combine nodes with same label sets</ul></ol><p>This makes large metric sets easier to navigate while preserving the full relational structure.<h2 id=examples>Examples</h2><p>See detailed examples organized by topic:<ul><li><a href=https://docs.nosqlbench.io/reference/apps/mql/mql-examples.md>Examples Overview</a> - Navigation and all examples<li><a href=https://docs.nosqlbench.io/reference/apps/mql/mql-instant-queries.md>Instant Queries</a> - Point-in-time queries<li><a href=https://docs.nosqlbench.io/reference/apps/mql/mql-range-queries.md>Range Queries</a> - Time-series queries<li>More examples coming for rate, aggregation, and quantile queries</ul><h2 id=database-location>Database Location</h2><p>By default, commands query <code>logs/metrics.db</code> which is a symlink to the current session’s metrics database.<p>To query a specific session:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>nb5</span><span> mql instant</span><span style=color:#bf616a> --db</span><span> logs/session_20251023_100000_metrics.db</span><span style=color:#bf616a> --metric</span><span> ops_total
</span></code></pre><h2 id=common-patterns>Common Patterns</h2><h3 id=discovery-navigation>Discovery & Navigation</h3><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Quick overview of all metrics
</span><span style=color:#bf616a>nb5</span><span> mql summary
</span><span>
</span><span style=color:#65737e># Explore label structure grouped by name
</span><span style=color:#bf616a>nb5</span><span> mql metrics</span><span style=color:#bf616a> --group-by</span><span> name
</span><span>
</span><span style=color:#65737e># See all label combinations (no condensation)
</span><span style=color:#bf616a>nb5</span><span> mql metrics</span><span style=color:#bf616a> --no-condense
</span><span>
</span><span style=color:#65737e># Group by label set structure instead of metric name
</span><span style=color:#bf616a>nb5</span><span> mql metrics</span><span style=color:#bf616a> --group-by</span><span> labelset
</span></code></pre><h3 id=monitoring>Monitoring</h3><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Current error count
</span><span style=color:#bf616a>nb5</span><span> mql instant</span><span style=color:#bf616a> --metric</span><span> api_requests_total</span><span style=color:#bf616a> --labels</span><span> status=500
</span><span>
</span><span style=color:#65737e># Request rate last 5 minutes
</span><span style=color:#bf616a>nb5</span><span> mql rate</span><span style=color:#bf616a> --metric</span><span> api_requests_total</span><span style=color:#bf616a> --window</span><span> 5m</span><span style=color:#bf616a> --labels</span><span> status=200
</span><span>
</span><span style=color:#65737e># p95 latency
</span><span style=color:#bf616a>nb5</span><span> mql quantile</span><span style=color:#bf616a> --metric</span><span> api_latency</span><span style=color:#bf616a> --p</span><span> 0.95
</span></code></pre><h3 id=analysis>Analysis</h3><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Total requests by endpoint
</span><span style=color:#bf616a>nb5</span><span> mql agg</span><span style=color:#bf616a> --metric</span><span> api_requests_total</span><span style=color:#bf616a> --func</span><span> sum</span><span style=color:#bf616a> --by</span><span> endpoint
</span><span>
</span><span style=color:#65737e># Top 10 busiest endpoints
</span><span style=color:#bf616a>nb5</span><span> mql topk</span><span style=color:#bf616a> --metric</span><span> api_requests_total</span><span style=color:#bf616a> --n</span><span> 10
</span><span>
</span><span style=color:#65737e># Error rate
</span><span style=color:#bf616a>nb5</span><span> mql ratio</span><span style=color:#bf616a> --numerator</span><span> errors_total</span><span style=color:#bf616a> --denominator</span><span> requests_total
</span></code></pre><h3 id=exporting-data>Exporting Data</h3><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># CSV for Excel
</span><span style=color:#bf616a>nb5</span><span> mql range</span><span style=color:#bf616a> --metric</span><span> ops_total</span><span style=color:#bf616a> --window</span><span> 1h</span><span style=color:#bf616a> --format</span><span> csv > metrics.csv
</span><span>
</span><span style=color:#65737e># JSON for analysis
</span><span style=color:#bf616a>nb5</span><span> mql summary</span><span style=color:#bf616a> --format</span><span> json > metrics_inventory.json
</span><span>
</span><span style=color:#65737e># Streaming JSONL
</span><span style=color:#bf616a>nb5</span><span> mql range</span><span style=color:#bf616a> --metric</span><span> ops_total</span><span style=color:#bf616a> --window</span><span> 1h</span><span style=color:#bf616a> --format</span><span> jsonl | </span><span style=color:#bf616a>jq </span><span>'</span><span style=color:#a3be8c>.value</span><span>'
</span></code></pre><h2 id=advanced-usage>Advanced Usage</h2><h3 id=sql-queries>SQL Queries</h3><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># Custom aggregation
</span><span style=color:#bf616a>nb5</span><span> mql sql</span><span style=color:#bf616a> --query </span><span>"
</span><span style=color:#a3be8c>  SELECT sn.sample, AVG(sv.value) as avg_value
</span><span style=color:#a3be8c>  FROM sample_value sv
</span><span style=color:#a3be8c>  JOIN metric_instance mi ON sv.metric_instance_id = mi.id
</span><span style=color:#a3be8c>  JOIN sample_name sn ON mi.sample_name_id = sn.id
</span><span style=color:#a3be8c>  GROUP BY sn.sample
</span><span>"
</span><span>
</span><span style=color:#65737e># Schema inspection
</span><span style=color:#bf616a>nb5</span><span> mql sql</span><span style=color:#bf616a> --query </span><span>"</span><span style=color:#a3be8c>PRAGMA table_info(metric_instance)</span><span>"
</span></code></pre><h3 id=query-debugging>Query Debugging</h3><p>The <code>--explain</code> flag shows the generated SQL query instead of executing it. Available on all query and calculation commands:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># See SQL for instant query
</span><span style=color:#bf616a>nb5</span><span> mql instant</span><span style=color:#bf616a> --metric</span><span> ops_total</span><span style=color:#bf616a> --explain
</span><span>
</span><span style=color:#65737e># See SQL for rate calculation
</span><span style=color:#bf616a>nb5</span><span> mql rate</span><span style=color:#bf616a> --metric</span><span> requests_total</span><span style=color:#bf616a> --window</span><span> 5m</span><span style=color:#bf616a> --explain
</span><span>
</span><span style=color:#65737e># See SQL for aggregation with grouping
</span><span style=color:#bf616a>nb5</span><span> mql agg</span><span style=color:#bf616a> --metric</span><span> api_requests_total</span><span style=color:#bf616a> --func</span><span> sum</span><span style=color:#bf616a> --by</span><span> endpoint</span><span style=color:#bf616a> --explain
</span></code></pre><p>This is useful for:<ul><li>Understanding how MetricsQL translates to SQL<li>Debugging unexpected query results<li>Learning the schema structure<li>Building custom queries with the <code>sql</code> command</ul><h2 id=learn-more>Learn More</h2><p>Run <code>nb5 help mql</code> to see this documentation.<p>For detailed examples, see the <a href=https://docs.nosqlbench.io/reference/apps/mql/docs/mql/README.md>examples README</a>.<nav><div></div><div><a href=https://docs.nosqlbench.io/reference/apps/cqlgen/> cqlgen ›</a></div></nav></article></main><footer><div class=c><nav class=tpad><div></div></nav><p>© <span id=year>2025</span> NoSQLBench Documentation<p>Powered by <a href=https://www.getzola.org/ target=_blank>Zola</a> & <a href=https://github.com/jieiku/abridge/ target=_blank>Abridge</a></div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>